import{_ as a,s as i,S as n,q as e}from"./chunks/framework.CB0sRpfv.js";const o=JSON.parse('{"title":"ubuntu 设置开机自启动","description":"","frontmatter":{"icon":"linux","date":"2024-11-10T00:00:00.000Z","category":["教程"],"tag":["linux"],"head":[["link",{"rel":"canonical","href":"https://blog.a7bz.cn/posts/2024/1110"}]]},"headers":[],"relativePath":"posts/2024/1110.md","filePath":"posts/2024/other/linuxSetAutoStart-1110.md"}'),t={name:"posts/2024/1110.md"};function l(p,s,r,h,d,k){return e(),i("div",null,s[0]||(s[0]=[n(`<h1 id="ubuntu-设置开机自启动" tabindex="-1">ubuntu 设置开机自启动 <a class="header-anchor" href="#ubuntu-设置开机自启动" aria-label="Permalink to &quot;ubuntu 设置开机自启动&quot;">​</a></h1><h2 id="创建-service-文件" tabindex="-1">创建.service 文件 <a class="header-anchor" href="#创建-service-文件" aria-label="Permalink to &quot;创建.service 文件&quot;">​</a></h2><p>在 <strong>/etc/systemd/system/</strong> 目录下新建一个 <strong>.service</strong> 文件。例如，为一个名为 <strong>custom</strong> 的服务，创建服务文件</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> touch</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/systemd/system/custom.service</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="编写-service-文件内容" tabindex="-1">编写 service 文件内容 <a class="header-anchor" href="#编写-service-文件内容" aria-label="Permalink to &quot;编写 service 文件内容&quot;">​</a></h2><p>桌面模式下，可以使用 <strong>gedit</strong> 编辑服务文件。</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gedit</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/systemd/system/custom.service</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>使用 <strong>nano</strong> 编辑服务文件。</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nano</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/systemd/system/custom.service</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>自行选择合适的方式</p><p>在服务文件中，定义服务的基本信息和启动参数。以下是一个示例文件：</p><div class="language-ini vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">[Unit]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Description</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=Custom Service </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#服务描述。</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">After</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=network.target </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#定义服务依赖关系，network.target 表示在网络启动后再启动该服务。</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">[Service]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ExecStart</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=/path/to/your/executable --option </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#指定服务启动的命令和参数，可以是可执行文件，脚本或者其他命令。</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WorkingDirectory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=/path/to/working/directory </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#指定服务运行时的工作目录。</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">User</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=username </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#指定服务的用户。</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Restart</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=on-failure </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#设置服务异常时重启。</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Environment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ENV_VAR_NAME=value&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> #设置环境变量</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">[Install]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WantedBy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=multi-user.target </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#定义服务的目标，通常 multi-user.target 表示在系统多用户模式下启动。</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>在 [Service] 部分，可以设置 StandardOutput 和 StandardError 选项，将日志输出重定向到指定的目标 可选值说明：</p><ul><li>journal: 将日志输出到 systemd 日志（即 journalctl），可以使用 journalctl -u &lt;service_name&gt; 查看。</li><li>null: 忽略日志输出。</li><li>tty: 将日志输出到 TTY（终端），如果正在使用终端调试时有用。</li><li>file:/path/to/logfile: 将日志输出到指定文件。</li></ul></div><p>示例值:</p><div class="language-ini vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">[Service]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">StandardOutput</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=journal</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">StandardError</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=file:/var/log/my_service_error.log</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="重新加载-systemd" tabindex="-1">重新加载 systemd <a class="header-anchor" href="#重新加载-systemd" aria-label="Permalink to &quot;重新加载 systemd&quot;">​</a></h2><p>每次修改 .service 文件后，都需要重新加载 systemd 配置：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> daemon-reload</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="启动并启用服务" tabindex="-1">启动并启用服务 <a class="header-anchor" href="#启动并启用服务" aria-label="Permalink to &quot;启动并启用服务&quot;">​</a></h2><p>启动服务并设置为开机自启：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> custom.service</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> custom.service</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="检查服务状态" tabindex="-1">检查服务状态 <a class="header-anchor" href="#检查服务状态" aria-label="Permalink to &quot;检查服务状态&quot;">​</a></h2><p>可以检查服务的运行状态，确保服务已正常启动：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> status</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> custom.service</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="停止和禁用服务" tabindex="-1">停止和禁用服务 <a class="header-anchor" href="#停止和禁用服务" aria-label="Permalink to &quot;停止和禁用服务&quot;">​</a></h2><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> stop</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> custom.service</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> disable</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> custom.service</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div>`,26)]))}const u=a(t,[["render",l]]);export{o as __pageData,u as default};
