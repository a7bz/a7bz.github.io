---
icon: blog
date: 2026-01-17
category:
  - 问题解决
tag:
  - blog
---

# 博客上次修改时间的正确实现

## 问题背景

在博客搭建过程中，我发现一个困扰已久的问题：文章的"上次修改时间"总是显示为构建部署的时间，而不是文章内容真正的最后修改时间。这导致了以下问题：

1. **信息不准确**：读者无法了解文章的实际更新时间
2. **SEO 影响**：搜索引擎可能会认为内容是最新的，影响搜索结果排序
3. **用户体验**：定期构建部署会让所有文章的修改时间都被更新，造成混淆

## 原因分析

经过排查，我发现问题出在 GitHub Actions 的工作流设计上：

- 每次构建部署时，CI/CD 环境会重新克隆仓库
- 克隆后的文件会获得新的修改时间戳（即构建时间）
- 本博客默认使用文件系统的修改时间
- 因此所有文章的修改时间都被重置为构建时间

## 解决方案

为了解决这个问题，我修改了 GitHub Actions 工作流文件，添加了文件修改时间恢复步骤：

### 关键修改

在 `.github/workflows/deploy-docs.yml` 文件中，我添加了以下步骤：

```yaml
- name: 恢复文件修改时间
  uses: chetan/git-restore-mtime-action@v2
  with:
    args: posts/
```

### 完整工作流分析

现在的完整工作流包含以下关键步骤：

1. **代码检出**：使用 `fetch-depth: 0` 获取完整历史记录，这对恢复时间戳至关重要
2. **环境设置**：配置 Node.js 环境和依赖
3. **时间戳恢复**：使用 `git-restore-mtime-action` 恢复 `posts/` 目录中文件的修改时间
4. **文档构建**：正常构建文档
5. **部署**：部署到 GitHub Pages

### 工作原理

`git-restore-mtime-action` 这个 GitHub Action 的工作原理是：

1. 分析 Git 仓库的提交历史
2. 查找每个文件的最后一次提交时间
3. 将文件系统的修改时间设置为该提交时间
4. 这样就确保了文件的修改时间反映的是内容的实际更新时间，而非构建时间

## 实现效果

通过这个修改，现在博客的"上次修改时间"显示的是：

- **准确的内容更新时间**：反映文章真正的最后修改时间
- **一致的时间戳**：不受构建部署频率的影响
- **更好的用户体验**：读者可以清楚了解文章的更新状态
- **更合理的 SEO**：搜索引擎可以获得更准确的内容时效性信息

## 技术细节

1. **为什么使用 `fetch-depth: 0`**：
   - 这个参数确保克隆完整的 Git 历史记录
   - 如果不设置，默认只会获取最近一次提交，无法恢复更早的文件修改时间

2. **为什么只针对 `posts/` 目录**：
   - 博客文章通常存储在 `posts/` 目录中
   - 只恢复这个目录的时间戳可以提高构建效率
   - 其他配置文件和模板文件的修改时间对读者意义不大

3. **为什么选择 `chetan/git-restore-mtime-action`**：
   - 这是一个专门用于恢复 Git 文件修改时间的 Action
   - 配置简单，使用方便
   - 支持指定目录，灵活性高
   - 社区活跃度高，维护良好

## 总结

通过修改 GitHub Actions 工作流，添加文件修改时间恢复步骤，我成功解决了博客上次修改时间显示为构建时间的问题。现在，博客文章的修改时间能够准确反映内容的实际更新时间，提升了用户体验和 SEO 效果。

这个解决方案不仅适用于我的博客，也可以推广到其他使用静态站点生成器的项目中，帮助更多开发者解决类似的时间戳问题。

如果你也遇到了类似的问题，不妨尝试在你的工作流中添加这个时间戳恢复步骤，让你的网站显示更准确的内容更新时间。